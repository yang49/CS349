-- Question: 4
-- The strategy behind the formulation of my answer:
--		First group the enrollment table by cno and term and calculate the corresponding
--    class capacity and class average.
--    Then select those students with grade on a course that is >= 98 and find that course
--    from the information I found in the first step.


SELECT		e.sno, e.cno, e.mark - avg_mark
FROM		 	(SELECT 			cno, term, COUNT(sno) AS cap, AVG(mark) AS avg_mark
			    FROM 			enrollment
			    GROUP BY 		cno, term) t1,
			   enrollment e
WHERE			(e.mark > 98 AND t1.cno = e.cno AND t1.term = e.term)
ORDER BY    e.sno, t1.cno
			 ;
			 
			 
<OUTPUT>
20002939|CS482|17.5625
20037890|PHYS255|17.3636363636364
20099883|CS488|16.24
20163094|CS247|14.5555555555556
20163094|PHYS497|17.3333333333333
20193175|CS449|16.0
20248082|CS350|17.3846153846154
20304343|MATH285|15.875
20458699|MATH210|14.375
20458853|PHYS451|12.1666666666667
20591079|PHYS420|15.6666666666667
20591079|PHYS451|19.1333333333333
20602987|CS312|15.125
20602987|CS458|17.9565217391304
20652458|PHYS364|12.7777777777778
20842491|PHYS484|14.1428571428571
20862191|MATH334|17.6666666666667
20936107|PHYS484|17.4615384615385
20938960|PHYS285|19.6923076923077
20954626|MATH395|16.3666666666667
21090840|PHYS193|14.6153846153846
21152057|PHYS289|14.5
21210918|CS485|18.7368421052632
21229888|PHYS124|20.28
21267773|PHYS124|20.28
21288103|PHYS451|12.1666666666667
21407646|PHYS263|17.2
21433509|PHYS446|13.0
21495049|PHYS458|17.5652173913043
21568625|MATH399|15.4
21646983|PHYS361|20.625
21649510|MATH459|13.1
21649510|PHYS221|12.3333333333333
21670504|PHYS485|10.5
21676293|CS488|17.2727272727273
21676293|MATH399|15.0588235294118
21750774|PHYS483|15.8181818181818
21767530|MATH261|19.0857142857143
21768045|MATH250|16.5714285714286
21818793|CS485|17.1818181818182
21821244|MATH491|14.4444444444444
21906995|CS432|16.0
21947461|CS316|17.9615384615385
21955374|CS484|12.9
21960289|PHYS414|14.3571428571429
21993697|MATH226|17.1111111111111
22046341|MATH452|12.6
22052239|PHYS255|18.1111111111111
22078262|MATH355|18.03125
22215932|MATH217|17.4666666666667
22233056|MATH261|17.6315789473684
22289300|PHYS388|13.0
22296412|CS486|16.6
22318590|PHYS133|19.2105263157895
22468169|MATH479|17.0
22492414|CS314|17.3809523809524
22556132|CS489|17.6842105263158
22564251|CS476|15.0555555555556
22788590|CS312|14.9642857142857
22788590|CS487|17.5882352941177
23008065|PHYS485|14.3333333333333
23010891|MATH382|20.7647058823529
23049532|CS312|15.9642857142857
23067117|MATH192|18.375
23067117|MATH427|19.5714285714286
23193544|CS316|18.0588235294118
23214247|CS316|15.9285714285714
23240776|PHYS312|17.8387096774194
23267930|PHYS271|16.5
23314441|MATH340|17.5
23357206|MATH459|13.3
23381814|CS213|18.3
23442335|CS436|17.5172413793103
23486913|CS370|17.6470588235294
23543938|PHYS460|13.8571428571429
23591313|PHYS484|14.625
23610816|CS211|17.1363636363636
23749666|CS218|18.4545454545455
23759303|PHYS147|12.9090909090909
23805142|CS247|14.3333333333333
24002271|CS486|17.7058823529412
24077663|PHYS368|16.6
24125617|MATH334|16.1428571428571
24163544|MATH245|16.125
24169469|MATH358|17.2857142857143
24176094|PHYS452|16.6
24236259|PHYS477|18.9090909090909
24287823|MATH427|16.9047619047619
24294227|CS348|17.8181818181818
24410026|CS215|17.6
24596751|MATH217|18.8
24613564|CS338|24.3389830508475
24637521|CS314|15.5454545454545
24676943|PHYS254|20.0416666666667
24860703|PHYS147|16.7333333333333
24885811|PHYS194|17.7058823529412
24886621|CS446|12.3
24888192|CS350|16.3846153846154
24989644|PHYS193|17.3333333333333
25129806|CS137|16.0606060606061
25132581|CS476|17.1363636363636
25286278|MATH192|18.6875
25330788|MATH382|17.25
25365706|CS313|15.6666666666667
25664679|MATH424|18.6111111111111
25672769|CS436|15.2
25743829|MATH459|14.1
25799060|MATH362|18.2439024390244
25800239|CS135|17.1590909090909
25827649|PHYS420|11.4
25830348|PHYS254|14.3684210526316
25835768|MATH217|18.0
25984438|MATH441|19.6
25987170|PHYS398|20.3589743589744
26044854|CS450|15.5
26207553|PHYS478|16.0909090909091
26247302|PHYS244|18.25
26256419|MATH383|15.2857142857143
26342477|PHYS388|17.75
26523244|CS487|17.8181818181818
26570974|CS462|18.7142857142857
26607054|MATH358|14.8
26627237|MATH221|15.3333333333333
26653529|CS115|19.9333333333333
26698118|PHYS271|17.75
26836481|MATH381|15.8571428571429
27007594|PHYS271|15.0555555555556
27007594|PHYS317|21.3888888888889
27007594|PHYS458|19.5555555555556
27168359|PHYS420|17.6363636363636
27279702|CS490|16.9230769230769
27279702|PHYS290|16.8
27279702|PHYS485|15.9130434782609
27292661|MATH285|16.4444444444444
27357294|PHYS271|17.75
27386745|MATH192|17.7
27421447|MATH197|18.0
27464811|CS247|14.125
27493259|PHYS457|12.3571428571429
27532359|CS230|14.9
27657997|MATH375|14.5555555555556
27717039|MATH381|17.5
27722125|CS246|16.0
27729518|CS147|18.2222222222222
27729902|MATH382|16.5789473684211
27792707|PHYS255|18.1111111111111
27902980|PHYS484|18.4615384615385
28013643|CS146|15.0
28025345|MATH428|17.1666666666667
28192879|PHYS337|17.125
28231389|MATH459|12.3
28234450|MATH261|16.0
28284876|MATH399|17.8260869565217
28471310|PHYS257|19.2857142857143
28473457|MATH399|18.8260869565217
28513198|MATH226|15.8
28539436|CS240|18.2857142857143
28580040|CS458|21.1
28638811|PHYS474|17.375
28921899|PHYS414|13.8
29017604|PHYS455|16.7
29050897|MATH395|17.2142857142857
29067979|MATH399|16.0588235294118
29119934|CS240|10.75
29171697|MATH197|15.0
29466896|CS312|17.75
29501010|PHYS368|18.5714285714286
29507951|MATH452|16.1904761904762
29615296|PHYS317|20.0
29643474|CS211|16.1363636363636
29808557|PHYS254|19.0416666666667
29877646|CS230|13.0
